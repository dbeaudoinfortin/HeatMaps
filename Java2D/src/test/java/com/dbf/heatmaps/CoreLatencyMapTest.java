package com.dbf.heatmaps;

import java.awt.Color;
import java.awt.Font;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;

import org.junit.jupiter.api.Test;

import com.dbf.heatmaps.HeatMap;
import com.dbf.heatmaps.HeatMapGradient;
import com.dbf.heatmaps.HeatMapOptions;
import com.dbf.heatmaps.axis.IntegerAxis;
import com.dbf.heatmaps.data.BasicDataRecord;
import com.dbf.heatmaps.data.DataRecord;

class CoreLatencyMapTest extends AbstractHeatMapTest {

	@Test
	void CoreLatencyHeatMapTest() throws IOException {
		File output = getTempFile("core_latency.png");
		System.out.println("Generating the core latency test heat map at file " + output.getAbsolutePath());
		
		ArrayList<DataRecord> records = new ArrayList<DataRecord>(latencies.length);
		int arrayIndex = 0;
		for (int y = 1; y <= 32; y++) {
			for (int x = 1; x <= 32; x++ ) {
				
				final double value = latencies[arrayIndex];
				if (value >= 0) {
					records.add(new BasicDataRecord(x,y,value));
				}
				arrayIndex++;
			}
		}
		
		HeatMap.builder()
			.withTitle("CPU Core-to-Core Latency (ns)")
			.withXAxis(IntegerAxis.instance()
					.withTitle("Core")
					.addEntries(1, 32))
			.withYAxis(IntegerAxis.instance()
					.withTitle("Core")
					.addEntries(1, 32))
			.withOptions(HeatMapOptions.builder()
					.withCellWidth(20)
					.withCellHeight(20)
					.withShowGridlines(true)
					.withGridLineColour(Color.WHITE)
					.withGradient(HeatMapGradient.EXTENDED_GRADIENT)
					.withBackgroundColour(Color.BLACK)
					.withAxisTitleFontColour(Color.WHITE)
					.withHeatMapTitleFontColour(Color.WHITE)
					.withAxisLabelFontColour(Color.WHITE)
					.withGridValuesFontColour(Color.WHITE)
					.withShowGridValues(true)
					.withHeatMapTitlePadding(20)
					.withShowLegend(true)
					.withLegendTextFormat("0.#")
					.withAxisLabelFont(new Font("Consolas", Font.PLAIN, 26))
					.withGridValuesFont(new Font("Consolas", Font.PLAIN, 12))
					.withAxisTitleFont(new Font("Consolas", Font.PLAIN, 30))
					.withLegendLabelFontColour(Color.WHITE)
					.withLegendSteps(20)
					.withColourScaleLowerBound(6.0)
					.withColourScaleUpperBound(80.0)
					.build())
		.build()
		.render(output, records);
		System.out.println("Generated the core latency test heat map at file " + output.getAbsolutePath());
	}

	private static final double[] latencies = { -1, 6.3, 15.7, 16.4, 14, 13.8, 15.2, 15.2, 15.6, 15.6, 15.7, 15.7, 16.9,
			16.9, 17.6, 17.6, 75.8, 75.8, 76.5, 76.5, 75, 75, 76.6, 76.7, 76.4, 76.4, 78, 78, 76.7, 76.8, 77.1, 77.1,
			6.3, -1, 16.3, 16.4, 15.1, 13.8, 15.2, 15.2, 15.6, 15.6, 15.7, 15.7, 16.9, 16.9, 17.5, 17.6, 75.7, 75.7,
			76.5, 76.5, 75, 75, 76.7, 76.7, 76.3, 76.3, 78, 78, 76.8, 76.8, 77.1, 77.1, 15.7, 16.3, -1, 6.3, 16, 15,
			17.6, 17.6, 16.3, 16.3, 18.2, 18.2, 17.2, 17.3, 17.6, 17.6, 75.7, 75.7, 76.5, 76.5, 75, 75, 76.5, 76.6,
			76.3, 76.2, 78, 78, 76.6, 76.6, 77, 77, 16.4, 16.4, 6.3, -1, 14.7, 15.2, 17.6, 17.6, 16.3, 16.3, 18.2, 18.2,
			17.4, 17.4, 17.6, 17.6, 75.7, 75.7, 76.5, 76.5, 75, 75, 76.5, 76.6, 76.3, 76.3, 78, 78, 76.7, 76.6, 77, 77,
			14, 15.1, 16, 14.7, -1, 6.3, 16.4, 16.5, 15.1, 15.1, 16.6, 16.6, 14.5, 14.3, 16.4, 16.5, 75.1, 75.1, 76, 76,
			74.6, 74.6, 76.5, 76.5, 75.6, 75.6, 77.4, 77.5, 76.4, 76.4, 76.5, 76.6, 13.8, 13.8, 15, 15.2, 6.3, -1, 16.5,
			16.4, 15.1, 15.1, 16.6, 16.6, 14.5, 14.5, 16.4, 16.4, 75.1, 75.1, 76, 76, 74.6, 74.6, 76.4, 76.5, 75.6,
			75.6, 77.5, 77.4, 76.4, 76.4, 76.6, 76.5, 15.2, 15.2, 17.6, 17.6, 16.4, 16.5, -1, 6.3, 17.5, 17.5, 18.2,
			18.2, 15.7, 15.7, 18.1, 18.1, 76.5, 76.5, 77.1, 77.1, 75.8, 75.9, 77.7, 77.7, 76.8, 76.8, 78.6, 78.6, 77.7,
			77.7, 78, 78, 15.2, 15.2, 17.6, 17.6, 16.5, 16.4, 6.3, -1, 17.5, 17.5, 18.2, 18.2, 15.7, 15.7, 18.2, 18.2,
			76.5, 76.5, 77.1, 77.1, 75.8, 75.9, 77.7, 77.7, 76.8, 76.8, 78.6, 78.6, 77.7, 77.7, 78, 78, 15.6, 15.6,
			16.3, 16.3, 15.1, 15.1, 17.5, 17.5, -1, 6.2, 15.8, 15.7, 14.5, 14.5, 15.2, 15.2, 75.4, 75.4, 76.4, 76.4, 75,
			75, 76.6, 76.5, 76, 76, 77.9, 77.9, 76.5, 76.5, 76.9, 76.9, 15.6, 15.6, 16.3, 16.3, 15.1, 15.1, 17.5, 17.5,
			6.2, -1, 15.7, 15.7, 14.5, 14.5, 15.2, 15.2, 75.3, 75.4, 76.3, 76.3, 75, 74.9, 76.5, 76.5, 76, 75.9, 77.9,
			77.9, 76.5, 76.5, 76.8, 76.9, 15.7, 15.7, 18.2, 18.2, 16.6, 16.6, 18.2, 18.2, 15.8, 15.7, -1, 6.3, 18, 18,
			18.2, 18.2, 77.2, 77.2, 78, 78, 76.5, 76.5, 78.1, 78.1, 77.6, 77.6, 79.5, 79.5, 78.1, 78.1, 78.2, 78.2,
			15.7, 15.7, 18.2, 18.2, 16.6, 16.6, 18.2, 18.2, 15.7, 15.7, 6.3, -1, 18, 18, 18.2, 18.2, 77.2, 77.3, 78, 78,
			76.5, 76.5, 78, 78.1, 77.6, 77.6, 79.5, 79.5, 78.1, 78.2, 78.2, 78.2, 16.9, 16.9, 17.2, 17.4, 14.5, 14.5,
			15.7, 15.7, 14.5, 14.5, 18, 18, -1, 6.3, 17.5, 17.5, 76, 76, 76.5, 76.5, 75, 75, 76.7, 76.7, 76.4, 76.4, 78,
			78, 76.9, 76.9, 77, 77.1, 16.9, 16.9, 17.3, 17.4, 14.3, 14.5, 15.7, 15.7, 14.5, 14.5, 18, 18, 6.3, -1, 17.5,
			17.5, 76, 76, 76.5, 76.5, 75, 75, 76.6, 76.6, 76.4, 76.4, 78, 78, 76.9, 76.9, 77, 77, 17.6, 17.5, 17.6,
			17.6, 16.4, 16.4, 18.1, 18.2, 15.2, 15.2, 18.2, 18.2, 17.5, 17.5, -1, 6.2, 76.5, 76.5, 76.7, 76.7, 75.5,
			75.5, 77.3, 77.3, 76.5, 76.5, 78.2, 78.1, 77.3, 77.3, 77.9, 77.9, 17.6, 17.6, 17.6, 17.6, 16.5, 16.4, 18.1,
			18.2, 15.2, 15.2, 18.2, 18.2, 17.5, 17.5, 6.2, -1, 76.5, 76.5, 76.7, 76.7, 75.4, 75.5, 77.3, 77.3, 76.5,
			76.5, 78.1, 78.1, 77.3, 77.3, 77.9, 77.9, 75.8, 75.7, 75.7, 75.7, 75.1, 75.1, 76.5, 76.5, 75.4, 75.3, 77.2,
			77.2, 76, 76, 76.5, 76.5, -1, 6.5, 16.9, 16.9, 14.6, 14.2, 15.7, 15.7, 16.1, 16.1, 16.2, 16.2, 17.4, 17.4,
			18.1, 18.2, 75.8, 75.7, 75.7, 75.7, 75.1, 75.1, 76.5, 76.5, 75.4, 75.4, 77.2, 77.3, 76, 76, 76.5, 76.5, 6.5,
			-1, 16.9, 17, 14.8, 13.7, 15.7, 15.7, 16.1, 16.1, 16.2, 16.2, 17.4, 17.4, 18.2, 18.2, 76.5, 76.5, 76.5,
			76.5, 76, 76, 77.1, 77.1, 76.4, 76.3, 78, 78, 76.5, 76.5, 76.7, 76.7, 16.9, 16.9, -1, 6.5, 15.1, 16.4, 18.2,
			18.2, 16.7, 16.7, 18.7, 18.7, 17.9, 18, 18.1, 18.1, 76.5, 76.5, 76.5, 76.5, 76, 76, 77.1, 77.1, 76.4, 76.3,
			78, 78, 76.5, 76.5, 76.7, 76.7, 16.9, 17, 6.5, -1, 16.4, 15.3, 18.2, 18.2, 16.7, 16.7, 18.7, 18.7, 18, 18,
			18.1, 18.1, 75, 75, 75, 75, 74.6, 74.6, 75.8, 75.8, 75, 75, 76.5, 76.5, 75, 75, 75.5, 75.4, 14.6, 14.8,
			15.1, 16.4, -1, 6.5, 16.9, 16.9, 15.5, 15.6, 17.1, 16.8, 14.6, 14.7, 17, 16.9, 75, 75, 75, 75, 74.6, 74.6,
			75.9, 75.9, 75, 74.9, 76.5, 76.5, 75, 75, 75.5, 75.5, 14.2, 13.7, 16.4, 15.3, 6.5, -1, 16.9, 16.9, 15.5,
			15.6, 17, 16.7, 14.7, 14.9, 16.9, 17, 76.6, 76.7, 76.5, 76.5, 76.5, 76.4, 77.7, 77.7, 76.6, 76.5, 78.1, 78,
			76.7, 76.6, 77.3, 77.3, 15.7, 15.7, 18.2, 18.2, 16.9, 16.9, -1, 6.5, 18, 18.1, 18.6, 18.6, 16.2, 16.2, 18.7,
			18.7, 76.7, 76.7, 76.6, 76.6, 76.5, 76.5, 77.7, 77.7, 76.5, 76.5, 78.1, 78.1, 76.7, 76.6, 77.3, 77.3, 15.7,
			15.7, 18.2, 18.2, 16.9, 16.9, 6.5, -1, 18, 18.1, 18.6, 18.6, 16.2, 16.2, 18.7, 18.7, 76.4, 76.3, 76.3, 76.3,
			75.6, 75.6, 76.8, 76.8, 76, 76, 77.6, 77.6, 76.4, 76.4, 76.5, 76.5, 16.1, 16.1, 16.7, 16.7, 15.5, 15.5, 18,
			18, -1, 6.5, 16.1, 16.2, 15, 15, 15.6, 15.6, 76.4, 76.3, 76.2, 76.3, 75.6, 75.6, 76.8, 76.8, 76, 75.9, 77.6,
			77.6, 76.4, 76.4, 76.5, 76.5, 16.1, 16.1, 16.7, 16.7, 15.6, 15.6, 18.1, 18.1, 6.5, -1, 16.2, 16.2, 15, 15,
			15.6, 15.6, 78, 78, 78, 78, 77.4, 77.5, 78.6, 78.6, 77.9, 77.9, 79.5, 79.5, 78, 78, 78.2, 78.1, 16.2, 16.2,
			18.7, 18.7, 17.1, 17, 18.6, 18.6, 16.1, 16.2, -1, 6.5, 18.6, 18.6, 18.7, 18.7, 78, 78, 78, 78, 77.5, 77.4,
			78.6, 78.6, 77.9, 77.9, 79.5, 79.5, 78, 78, 78.1, 78.1, 16.2, 16.2, 18.7, 18.7, 16.8, 16.7, 18.6, 18.6,
			16.2, 16.2, 6.5, -1, 18.6, 18.6, 18.7, 18.7, 76.7, 76.8, 76.6, 76.7, 76.4, 76.4, 77.7, 77.7, 76.5, 76.5,
			78.1, 78.1, 76.9, 76.9, 77.3, 77.3, 17.4, 17.4, 17.9, 18, 14.6, 14.7, 16.2, 16.2, 15, 15, 18.6, 18.6, -1,
			6.5, 18, 18, 76.8, 76.8, 76.6, 76.6, 76.4, 76.4, 77.7, 77.7, 76.5, 76.5, 78.1, 78.2, 76.9, 76.9, 77.3, 77.3,
			17.4, 17.4, 18, 18, 14.7, 14.9, 16.2, 16.2, 15, 15, 18.6, 18.6, 6.5, -1, 18, 18, 77.1, 77.1, 77, 77, 76.5,
			76.6, 78, 78, 76.9, 76.8, 78.2, 78.2, 77, 77, 77.9, 77.9, 18.1, 18.2, 18.1, 18.1, 17, 16.9, 18.7, 18.7,
			15.6, 15.6, 18.7, 18.7, 18, 18, -1, 6.5, 77.1, 77.1, 77, 77, 76.6, 76.5, 78, 78, 76.9, 76.9, 78.2, 78.2,
			77.1, 77, 77.9, 77.9, 18.2, 18.2, 18.1, 18.1, 16.9, 17, 18.7, 18.7, 15.6, 15.6, 18.7, 18.7, 18, 18, 6.5,
			-1 };

}
